#!/bin/sh
set -e

APP_DESKTOP="@PROJECT_PACKAGE_NAME@.desktop"
SRC="/opt/@PROJECT_FAMILY_NAME@/@PROJECT_SHORT_REL_NAME@/desktop/$APP_DESKTOP"
DST="/usr/share/applications/$APP_DESKTOP"

# Install system-wide desktop entry
if [ -f "$SRC" ]; then
  install -D -m 0644 "$SRC" "$DST"
fi

# Refresh desktop DB if available
if command -v update-desktop-database >/dev/null 2>&1; then
  update-desktop-database -q || true
fi

# Install theme icon for GNOME
ICON_SRC="/opt/@PROJECT_FAMILY_NAME@/@PROJECT_SHORT_REL_NAME@/pixmaps/@PROJECT_PACKAGE_NAME@.svg"
ICON_DST="/usr/share/icons/hicolor/scalable/apps/@PROJECT_PACKAGE_NAME@.svg"
if [ -f "$ICON_SRC" ]; then
  install -D -m 0644 "$ICON_SRC" "$ICON_DST"
fi

# Refresh caches
command -v update-desktop-database >/dev/null 2>&1 && update-desktop-database -q || true
if command -v gtk-update-icon-cache >/dev/null 2>&1; then
  gtk-update-icon-cache -q /usr/share/icons/hicolor || true
fi

exit 0
